name: Version Bump

# 手動でバージョンアップを実行するためのワークフロー
# GitHub Actions UIから実行し、patch/minor/major を選択可能
on:
  workflow_dispatch:
    inputs:
      version_type:
        description: 'Version type'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch   # 1.0.0 → 1.0.1 (バグ修正)
          - minor   # 1.0.0 → 1.1.0 (新機能追加)
          - major   # 1.0.0 → 2.0.0 (破壊的変更)

jobs:
  version-bump:
    runs-on: ubuntu-latest
    
    steps:
      # リポジトリのチェックアウト
      # 注意: プライベートリポジトリの場合、PAT_TOKEN が必要
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN || secrets.GITHUB_TOKEN }}
          
      # Node.js環境のセットアップ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      # Gitユーザー設定（コミット作成用）
      - name: Configure Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
      # バージョンアップの実行
      # npm version コマンドは自動的にコミットとタグを作成
      - name: Bump version
        run: |
          npm version ${{ github.event.inputs.version_type }} -m "chore: bump version to %s"
          
      # 変更をリモートリポジトリにプッシュ
      # これにより npm-publish.yml ワークフローがトリガーされる
      - name: Push changes
        run: |
          git push origin main
          git push origin --tags